<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Word Quiz</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCgSFDj7fRw6HSvZyOz1g5IM749f2sY55M",
  authDomain: "wordquiz-659d7.firebaseapp.com",
  databaseURL: "https://wordquiz-659d7-default-rtdb.firebaseio.com",
  projectId: "wordquiz-659d7",
  storageBucket: "wordquiz-659d7.firebasestorage.app",
  messagingSenderId: "785560761880",
  appId: "1:785560761880:web:9455e5767af0e0b9b1f56d"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
</script>

<link rel="manifest" href="manifest.json">
<style>
html, body { width:100%; height:100%; margin:0; padding:0; overflow:hidden; touch-action:manipulation; }
body {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height: 100vh;
  font-family: Arial, sans-serif;
  
  /* —Ñ–æ–Ω */
  background-image: url('mountains.jpg'); /* –ø—É—Ç—å –∫ —Ç–≤–æ–µ–π –∫–∞—Ä—Ç–∏–Ω–∫–µ */
  background-size: cover;      /* —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
  background-position: center; /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç */
  background-repeat: no-repeat;
  
  /* –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –ª—É—á—à–µ —á–∏—Ç–∞–ª—Å—è */
  color: white;
}

header { width:100%; display:flex; justify-content:space-between; padding:15px 20px; box-sizing:border-box; align-items:center; box-shadow:0 2px 5px rgba(0,0,0,0.1); flex-wrap:wrap; }
#title { font-weight:bold; font-size:1.2rem; }
header div { display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center; }
button { padding:8px 4vw; font-weight:bold; border:none; border-radius:12px; cursor:pointer; transition:background-color 0.3s, transform 0.2s, box-shadow 0.2s; min-width:50px; }
#switchBtn { font-size:1.2rem; background:transparent; border:none; }
#switchBtn:hover { background-color: rgba(0,0,0,0.05); transform:scale(1.2);}
#fiftyBtn { background-color:#2196F3; color:white; }
#fiftyBtn:hover { background-color:#1976D2; }
#word { font-size:calc(20px + 4vw); text-align:center; margin:20px 0; word-wrap:break-word; font-weight:bold; }
.answers { display:grid; grid-template-columns:1fr 1fr; gap:15px; width:95%; max-width:600px; }
.answerBtn { background-color:#f2f2f2; border:1px solid #ccc; border-radius:12px; font-size:1.2rem; padding:10px; min-height:50px; transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s; cursor:pointer; font-weight:bold; word-wrap:break-word; white-space:normal; }
.answerBtn:hover { background-color:#e6e6e6; transform:scale(1.02); box-shadow:0 2px 5px rgba(0,0,0,0.2); }
.answerBtn.correct { background-color:#4CAF50; color:white; }
.answerBtn.wrong { background-color:#F44336; color:white; }
.answerBtn.disabled { background-color:#ddd; color:#666; }
#progressBar { width:95%; max-width:600px; height:20px; background:#eee; border-radius:10px; margin:15px 0; }
#progressFill { width:0%; height:100%; background:#4CAF50; border-radius:10px; transition:width 0.3s; }
#progress { font-size:1rem; text-align:center; }

#addListForm { display:none; flex-direction:column; gap:5px; margin:10px 0; width:95%; max-width:600px; }
#welcome {
  font-size: 10rem;           
  font-weight: bold;            
  text-align: center;
  margin: 20px 0;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
  color: #ffffff;               
  text-shadow: 2px 2px 5px rgba(0,0,0,0.2); 
  transition: opacity 0.5s ease; 
}
#listSelect {
  padding: 8px 12px;          /* –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –ø–æ–º–µ—â–∞–ª—Å—è */
  border-radius: 12px;        /* —Å–∫—Ä—É–≥–ª—ë–Ω–Ω—ã–µ —É–≥–ª—ã */
  border: 1px solid #ccc;     /* –ª—ë–≥–∫–∞—è —Ä–∞–º–∫–∞ */
  font-size: 1rem;            /* —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
  background: white;           /* —Ñ–æ–Ω */
  cursor: pointer;
  min-width: 150px;           /* –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞, —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –ø–æ–º–µ—â–∞–ª—Å—è */
  box-sizing: border-box;
}

/* –ï—Å–ª–∏ –Ω–∞–¥–æ, —á—Ç–æ–±—ã —Å—Ç—Ä–µ–ª–∫–∞ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ —Ç–æ–∂–µ –±—ã–ª–∞ –∫—Ä–∞—Å–∏–≤–æ–π */
#listSelect::-ms-expand { display: none; } /* –¥–ª—è IE/Edge */


@media (max-width:480px){ header{padding:10px;} #title{font-size:1rem;} button{font-size:0.9rem; padding:6px 10px;} #word{font-size:calc(18px + 4vw);} #progress{font-size:0.9rem;} }
</style>
</head>
<body>

<header>
  <span id="title"></span>

  <!-- –í—ã–±–æ—Ä –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–æ–≤ –ø—Ä—è–º–æ –≤ header -->
  <div style="display:flex; gap:10px; align-items:center;">
    <select id="listSelect">
      <option disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫</option>
    </select>
    <button id="addListToggle">+</button>
  </div>

  <div>
    <button id="switchBtn">üîÑ</button>
    <button id="fiftyBtn">50/50</button>
  </div>
</header>

<!-- –§–æ—Ä–º–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞ -->
<div id="addListForm">
  <input type="text" id="newListName" placeholder="–ò–º—è –Ω–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞">
  <textarea id="newListText" placeholder="–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—é–¥–∞ —Å–ª–æ–≤–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å–ª–æ–≤–æ;–ø–µ—Ä–µ–≤–æ–¥" rows="5"></textarea>
  <button id="addListBtn">–î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
</div>

<div id="word"></div>
<div class="answers" id="answers">
  <button class="answerBtn"></button>
  <button class="answerBtn"></button>
  <button class="answerBtn"></button>
  <button class="answerBtn"></button>
</div>

<div id="progressBar"><div id="progressFill"></div></div>
<div id="progress"></div>

<div id="welcome" style="font-size:1.2rem; text-align:center; margin:15px 0;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</div>
  
<script>
// –û—Å–Ω–æ–≤–Ω–æ–π JS –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
let words=[], allWords=[], index=0, correct_answers=0, wrong_answers=0;
let reverse=false, currentWord=null, remainingWords=[];

const switchBtn = document.getElementById('switchBtn');
const fiftyBtn = document.getElementById('fiftyBtn');
const wordDiv = document.getElementById('word');
const answersDiv = document.getElementById('answers');
const progressDiv = document.getElementById('progress');
const progressFill = document.getElementById('progressFill');

// –°–º–µ–Ω–∞ —è–∑—ã–∫–∞
switchBtn.addEventListener('click', ()=>{reverse=!reverse; if(currentWord) drawCurrentQuestion();});

// –ö–Ω–æ–ø–∫–∞ 50/50
fiftyBtn.addEventListener('click', useFifty);

// –§—É–Ω–∫—Ü–∏–∏ –≤–∏–∫—Ç–æ—Ä–∏–Ω—ã
function loadNextWord(){
  if(remainingWords.length===0){ alert('–í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ —Å–ª–æ–≤–∞!'); return; }
  currentWord=remainingWords.pop();
  index++;
    // –°–∫—Ä—ã–≤–∞–µ–º "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å" –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–æ–ø—Ä–æ—Å–µ
  const welcomeDiv = document.getElementById('welcome');
  if(welcomeDiv.style.display !== 'none'){
    welcomeDiv.style.display = 'none';
  }
  drawCurrentQuestion();
}

function drawCurrentQuestion(){
  const question=reverse?currentWord.trans:currentWord.word;
  const correct=reverse?currentWord.word:currentWord.trans;

  const allOptions=allWords.map(x=>reverse?x.word:x.trans).filter(x=>x!==correct);
  let options=[correct,...shuffleArray(allOptions).slice(0,3)];
  options=shuffleArray(options);

  wordDiv.textContent=question;
  progressDiv.textContent=`${index} –∏–∑ ${allWords.length} (${correct_answers}/${wrong_answers})`;
  progressFill.style.width=`${(index/allWords.length)*100}%`;

  const buttons=answersDiv.querySelectorAll('.answerBtn');
  buttons.forEach((btn,i)=>{
    btn.textContent=options[i]; btn.disabled=false; btn.className='answerBtn'; btn.onclick=()=>checkAnswer(btn,correct);
  });

  fiftyBtn.disabled=false;
}

function checkAnswer(btn, correct){
  if(btn.textContent===correct) correct_answers++; else wrong_answers++;
  const buttons=answersDiv.querySelectorAll('.answerBtn');
  buttons.forEach(b=>{
    b.disabled=true;
    if(b.textContent===correct) b.classList.add('correct');
    else if(b===btn) b.classList.add('wrong');
  });
  setTimeout(()=>loadNextWord(), btn.textContent===correct?500:4000);
}

function useFifty(){
  const correct=reverse?currentWord.word:currentWord.trans;
  let wrongBtns=Array.from(answersDiv.querySelectorAll('.answerBtn')).filter(b=>b.textContent!==correct&&!b.disabled);
  shuffleArray(wrongBtns).slice(0,2).forEach(b=>{ b.disabled=true; b.classList.add('disabled'); });
  fiftyBtn.disabled=true;
}

function shuffleArray(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i], array[j]]=[array[j], array[i]];
  }
  return array;
}

// ---------------- Firebase + —Å–ø–∏—Å–∫–∏ ----------------
const listSelect=document.getElementById('listSelect');
const addListToggle=document.getElementById('addListToggle');
const addListForm=document.getElementById('addListForm');
const addListBtn=document.getElementById('addListBtn');
const newListName=document.getElementById('newListName');
const newListText=document.getElementById('newListText');

// –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å–µ —Å–ø–∏—Å–∫–∏ –∏–∑ Firebase
function loadAllLists(){
  database.ref('lists').once('value').then(snapshot=>{
    const data=snapshot.val()||{};
    listSelect.innerHTML='<option disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫</option>';
    for(let key in data){
      const option=document.createElement('option');
      option.value=key; option.textContent=key;
      listSelect.appendChild(option);
    }
  });
}
loadAllLists();

// –í—ã–±–æ—Ä —Å–ø–∏—Å–∫–∞
listSelect.onchange=()=>{
  const selected=listSelect.value;
  if(!selected) return;
  database.ref('lists/'+selected).once('value').then(snapshot=>{
    const data=snapshot.val();
    words=Object.values(data);
    allWords=[...new Map(words.map(w=>[`${w.word};${w.trans}`,w])).values()];
    remainingWords=shuffleArray([...allWords]);
    index=0; correct_answers=0; wrong_answers=0; currentWord=null;
    loadNextWord();
  });
};

// –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
addListToggle.onclick=()=>{ addListForm.style.display=addListForm.style.display==='none'?'flex':'none'; };

// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Å–ø–∏—Å–æ–∫
addListBtn.onclick=()=>{
  const name=newListName.value.trim();
  const text=newListText.value.trim();
  if(!name||!text) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–ø–∏—Å–∫–∞ –∏ —Å–ª–æ–≤–∞');
  const newWords=text.split('\n').map(line=>{ const [word,trans]=line.split(';').map(x=>x.trim()); return {word,trans}; }).filter(x=>x.word&&x.trans);
  database.ref('lists/'+name).set(newWords).then(()=>{
    alert('–°–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω!'); newListName.value=''; newListText.value=''; addListForm.style.display='none'; loadAllLists();
  }).catch(err=>console.error(err));
};

// ---------------- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è ----------------
document.addEventListener('gesturestart', e=>e.preventDefault());
let lastTouchEnd=0;
document.addEventListener('touchend', e=>{
  const now=new Date().getTime();
  if(now-lastTouchEnd<=300) e.preventDefault();
  lastTouchEnd=now;
}, false);
document.addEventListener('touchstart', e=>{ if(e.touches.length>1) e.preventDefault(); }, {passive:false});
</script>
</body>
</html>








