<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Word Quiz</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCgSFDj7fRw6HSvZyOz1g5IM749f2sY55M",
  authDomain: "wordquiz-659d7.firebaseapp.com",
  databaseURL: "https://wordquiz-659d7-default-rtdb.firebaseio.com",
  projectId: "wordquiz-659d7",
  storageBucket: "wordquiz-659d7.firebasestorage.app",
  messagingSenderId: "785560761880",
  appId: "1:785560761880:web:9455e5767af0e0b9b1f56d"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
</script>

<link rel="manifest" href="manifest.json">
<style>
html, body { 
  width:100%; 
  height:100%; 
  margin:0; 
  padding:0; 
  overflow:hidden; 
  touch-action:manipulation; 
}

body {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  min-height:100vh;
  font-family: Arial, sans-serif;
  background-image: url('mountains.jpg');
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  color: white;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 15px;
  box-sizing: border-box;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  flex-wrap: nowrap;
  width: 100%;
}

header > div {
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
}

#title {
  font-weight: bold;
  font-size: 1.2rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

#listSelect {
  padding: 8px 12px;
  border-radius: 12px;
  border: 1px solid #ccc;
  font-size: 0.95rem;
  min-width: 100px;
  flex-shrink: 1; 
  text-overflow: ellipsis;
  overflow: hidden;
  white-space: nowrap;
  background: white;
  cursor: pointer;
}

#listSelect::-ms-expand { display: none; }

/* –ö–Ω–æ–ø–∫–∞ "+" */
#addListToggle {
  border-radius: 12px;
  padding: 8px 12px;
  font-weight: bold;
  background-color: #2196F3;
  color: white;
  cursor: pointer;
  flex-shrink: 0; /* –Ω–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
}


#switchBtn, #modeBtn, #fiftyBtn {
  padding: 8px 12px;
  border-radius: 12px;
  font-weight: bold;
  cursor: pointer;
  flex-shrink: 0;
}

#switchBtn {
  font-size: 1.2rem;
  background-color: #4CAF50; /* –∑–µ–ª—ë–Ω—ã–π —Ñ–æ–Ω */
  color: white;              /* –±–µ–ª—ã–π —Ç–µ–∫—Å—Ç/–∏–∫–æ–Ω–∫–∞ */
  border: none;
  border-radius: 12px;
  padding: 8px 12px;
  font-weight: bold;
  cursor: pointer;
  flex-shrink: 0;
}

#switchBtn:hover {
  background-color: #45a049; /* —Ç–µ–º–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  transform: scale(1.05);
}

#modeBtn { background-color:#FF9800; color:white; border:none; }
#modeBtn:hover { background-color:#F57C00; }
#fiftyBtn { background-color:#2196F3; color:white; }
#fiftyBtn:hover { background-color:#1976D2; }

#word {
  font-size:calc(20px + 4vw);
  text-align:center;
  margin:20px 0;
  word-wrap:break-word;
  font-weight:bold;
}
#word.placeholder { color: #ff4d4f; } /* –∫—Ä–∞—Å–Ω–∞—è –Ω–∞–¥–ø–∏—Å—å –¥–æ –≤—ã–±–æ—Ä–∞ —Å–ø–∏—Å–∫–∞ */

.answers { display:grid; grid-template-columns:1fr 1fr; gap:15px; width:95%; max-width:600px; }
.answerBtn { background-color:#f2f2f2; border:1px solid #ccc; border-radius:12px; font-size:1.2rem; padding:10px; min-height:50px; transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s; cursor:pointer; font-weight:bold; word-wrap:break-word; white-space:normal; }
.answerBtn:hover { background-color:#e6e6e6; transform:scale(1.02); box-shadow:0 2px 5px rgba(0,0,0,0.2); }
.answerBtn.correct { background-color:#4CAF50; color:white; }
.answerBtn.wrong { background-color:#F44336; color:white; }
.answerBtn.disabled { background-color:#ddd; color:#666; }

#progressBar { width:95%; max-width:600px; height:20px; background:#eee; border-radius:10px; margin:15px 0; }
#progressFill { width:0%; height:100%; background:#4CAF50; border-radius:10px; transition:width 0.3s; }
#progress { font-size:1rem; text-align:center; }

#addListForm { display:none; flex-direction:column; gap:5px; margin:10px 0; width:95%; max-width:600px; }

#welcomeWrapper {
  flex-grow: 1;              /* –∑–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë —Å–≤–æ–±–æ–¥–Ω–æ–µ –º–µ—Å—Ç–æ */
  display: flex;
  align-items: center;       /* –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
  justify-content: center;   /* –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
}

#welcome {
  font-size: 3rem;
  font-weight: bold;
  text-align: center;
  color: #ffffff;
  text-shadow: 2px 2px 5px rgba(0,0,0,0.3);
}

/* –ø–æ–ª–µ –≤–≤–æ–¥–∞ */
#answerInput {
  width: 100%;
  font-size: 1.3rem;
  padding: 14px;
  border-radius: 14px;
  border: 2px solid #ccc;
  box-sizing: border-box;
  margin-top: 10px;
  background: #fff;
  color: #000;
}
#answerInput.error {
  border: 2px solid red !important;
  box-shadow: 0 0 10px red;
}

#answerInput.success {
  border: 2px solid #00a550 !important;
  box-shadow: 0 0 10px #00a550;
}

#answerInput {
  transition: border-color 0.3s, box-shadow 0.3s;
}


/* —Ñ–∏–¥–±–µ–∫ –Ω–∞–¥ –ø–æ–ª–µ–º –≤–≤–æ–¥–∞ */
#feedback {
  width: 95%;
  max-width: 600px;
  text-align: center;
  margin: 20px 0 10px 0;     /* –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É */
  min-height: 2em;  
  font-size: 2rem;
  fontWeight = 'bold';
}
#feedback.ok { color: #00a550; }
#feedback.err { color: #ff0000; }

/* –∫–Ω–æ–ø–∫–∞ –æ—Ç–≤–µ—Ç–∞ —Å–Ω–∏–∑—É */
#submitAnswerBtn {
  width: 100%;
  max-width: 600px;
  font-size: 1.4rem;
  padding: 16px;
  border-radius: 16px;
  font-weight: bold;
  background-color: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
  transition: background 0.2s, transform 0.1s;
}
#submitAnswerBtn:hover { background-color: #45a049; transform: scale(1.02); }

#submitWrapper {
  position: sticky; /* –∏–ª–∏ fixed, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ */
  bottom: calc(10px + env(safe-area-inset-bottom)); /* –æ—Ç—Å—Ç—É–ø –æ—Ç –Ω–∏–∂–Ω–µ–≥–æ –∫—Ä–∞—è + –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞ */
  text-align: center;
  width: 95%;
  max-width: 600px;
  margin: 0 auto;
  z-index: 100; /* —á—Ç–æ–±—ã –∫–Ω–æ–ø–∫–∞ –±—ã–ª–∞ –ø–æ–≤–µ—Ä—Ö –¥—Ä—É–≥–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
}


@media (max-width:480px){
  #title { font-size: 1rem; }
  #listSelect { font-size: 0.8rem; min-width: 80px; }
  #addListToggle, #switchBtn, #modeBtn, #fiftyBtn { padding: 4px 8px; font-size: 0.8rem; }
  #word { font-size: calc(18px + 4vw); }
  #progress { font-size: 0.9rem; }
}
</style>
</head>
<body>

<header>
  <span id="title"></span>
  <div style="display:flex; gap:10px; align-items:center;">
    <select id="listSelect">
      <option disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫</option>
    </select>
    <button id="addListToggle">+</button>
    <button id="saveAllBtn">üíæ</button>
  </div>
  <div>
    <button id="switchBtn">üåê</button>
    <button id="modeBtn">‚úçÔ∏è</button>
    <button id="fiftyBtn">50/50</button>
  </div>
</header>

<div id="addListForm">
  <input type="text" id="newListName" placeholder="–ò–º—è –Ω–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞">
  <textarea id="newListText" placeholder="–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—é–¥–∞ —Å–ª–æ–≤–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å–ª–æ–≤–æ;–ø–µ—Ä–µ–≤–æ–¥" rows="5"></textarea>
  <button id="addListBtn">–î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
</div>

<div id="word" class="placeholder">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤</div>

<div class="answers" id="answers">
  <button class="answerBtn"></button>
  <button class="answerBtn"></button>
  <button class="answerBtn"></button>
  <button class="answerBtn"></button>
</div>

<div id="inputModeDiv" style="display:none; margin:20px 0; text-align:center; width:95%; max-width:600px;">
  <div id="feedback"></div>
  <input type="text" id="answerInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç" autocomplete="off" autocapitalize="none" spellcheck="false">
</div>

<div id="progressBar"><div id="progressFill"></div></div>
<div id="progress"></div>

<div id="submitWrapper" style="display:none; text-align:center; margin:20px 0; width:95%; max-width:600px;">
  <button id="submitAnswerBtn" type="button" tabindex="-1">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
</div>

<div id="welcomeWrapper">
  <div id="welcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</div>
</div>

<script>
let words=[], allWords=[], remainingWords=[], index=0, correct_answers=0, wrong_answers=0;
let reverse=false, currentWord=null, inputMode=false;

// —ç–ª–µ–º–µ–Ω—Ç—ã DOM
const DOM = {
  switchBtn: document.getElementById('switchBtn'),
  modeBtn: document.getElementById('modeBtn'),
  fiftyBtn: document.getElementById('fiftyBtn'),
  word: document.getElementById('word'),
  answers: document.getElementById('answers'),
  inputDiv: document.getElementById('inputModeDiv'),
  answerInput: document.getElementById('answerInput'),
  feedback: document.getElementById('feedback'),
  submitBtn: document.getElementById('submitAnswerBtn'),
  submitWrapper: document.getElementById('submitWrapper'),
  progress: document.getElementById('progress'),
  progressFill: document.getElementById('progressFill'),
  progressBar: document.getElementById('progressBar'),
  listSelect: document.getElementById('listSelect'),
  addListToggle: document.getElementById('addListToggle'),
  addListForm: document.getElementById('addListForm'),
  addListBtn: document.getElementById('addListBtn'),
  newListName: document.getElementById('newListName'),
  newListText: document.getElementById('newListText'),
  welcome: document.getElementById('welcome')
};

const saveAllBtn = document.getElementById('saveAllBtn');

saveAllBtn.onclick = async () => {
  try {
    const snapshot = await database.ref('lists').once('value');
    const data = snapshot.val() || {};
    localStorage.setItem('offlineLists', JSON.stringify(data));
    alert('–í—Å–µ —Å–ø–∏—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –æ—Ñ–ª–∞–π–Ω!');
  } catch (err) {
    console.error(err);
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–æ–≤');
  }
};

  
// –°–∫—Ä—ã—Ç–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
['answers','progress','progressFill','switchBtn','fiftyBtn','modeBtn','progressBar'].forEach(id=>{
  if(DOM[id]) DOM[id].style.display='none';
});

// --- —É—Ç–∏–ª–∏—Ç—ã ---
function shuffle(array){for(let i=array.length-1;i>0;i--){let j=Math.floor(Math.random()*(i+1));[array[i],array[j]]=[array[j],array[i]];} return array;}
function animateInput(className, duration=500){
  const input=DOM.answerInput;
  input.classList.add(className);
  input.style.transition='transform 0.2s';
  input.style.transform='translateY(-5px)';
  setTimeout(()=>{input.style.transform='translateY(5px)';
    setTimeout(()=>{input.style.transform='translateY(0)';},100);},100);
  setTimeout(()=>input.classList.remove(className),duration);
}
function focusInput(){requestAnimationFrame(()=>{DOM.answerInput.focus({preventScroll:true});const l=DOM.answerInput.value.length; try{DOM.answerInput.setSelectionRange(l,l);}catch(e){}});}

// --- –∏–≥—Ä–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª ---
function loadNextWord(){
  if(remainingWords.length===0){
    DOM.word.textContent='–ì–æ—Ç–æ–≤–æ! –í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ —Å–ª–æ–≤–∞ üéâ';
    DOM.word.classList.remove('placeholder');
    DOM.answers.style.display='none';
    DOM.inputDiv.style.display='none';
    DOM.submitWrapper.style.display='none';
    return;
  }
  currentWord=remainingWords.pop();
  index++;
  DOM.welcome.style.display='none';
  drawCurrentQuestion();
  focusInput();
}

function drawCurrentQuestion(){
  const question=reverse?currentWord.trans:currentWord.word;
  const correct=reverse?currentWord.word:currentWord.trans;
  DOM.word.textContent=question;
  DOM.word.classList.remove('placeholder');
  DOM.progress.textContent=`${index} –∏–∑ ${allWords.length} (${correct_answers}/${wrong_answers})`;
  DOM.progressFill.style.width=`${(index/allWords.length)*100}%`;

  if(!inputMode){
    const allOptions=allWords.map(x=>reverse?x.word:x.trans).filter(x=>x!==correct);
    const options=shuffle([correct,...shuffle(allOptions).slice(0,3)]);
    DOM.answers.querySelectorAll('.answerBtn').forEach((btn,i)=>{
      btn.textContent=options[i]; btn.disabled=false; btn.className='answerBtn';
      btn.onclick=()=>checkAnswer(btn,correct);
    });
    DOM.fiftyBtn.disabled=false;
  }else{
    DOM.feedback.textContent='';
    DOM.feedback.className='';
    DOM.answerInput.value='';
    focusInput();
    DOM.answerInput.onkeydown=(e)=>{if(e.key==='Enter'){e.preventDefault();submitFromButton();}};
  }
}

function checkAnswer(btn,correct){
  if(btn.textContent===correct) correct_answers++; else wrong_answers++;
  DOM.answers.querySelectorAll('.answerBtn').forEach(b=>{
    b.disabled=true;
    if(b.textContent===correct) b.classList.add('correct');
    else if(b===btn) b.classList.add('wrong');
  });
  setTimeout(loadNextWord, btn.textContent===correct?500:2000);
}

function checkTextAnswer(user,correct){
  if(!user){animateInput('error'); focusInput(); return;}
  if(user.toLowerCase()===correct.toLowerCase()){correct_answers++; animateInput('success'); setTimeout(loadNextWord,500);}
  else{wrong_answers++; DOM.feedback.textContent=correct; DOM.feedback.className='err'; setTimeout(loadNextWord,3000);}
  focusInput();
}

function submitFromButton(){if(!currentWord) return; const correct=reverse?currentWord.word:currentWord.trans; checkTextAnswer(DOM.answerInput.value.trim(),correct);}
function useFifty(){
  const correct=reverse?currentWord.word:currentWord.trans;
  let wrongBtns=Array.from(DOM.answers.querySelectorAll('.answerBtn')).filter(b=>b.textContent!==correct&&!b.disabled);
  shuffle(wrongBtns).slice(0,2).forEach(b=>{b.disabled=true;b.classList.add('disabled');});
  DOM.fiftyBtn.disabled=true;
}

// --- –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ---
DOM.switchBtn.onclick=()=>{reverse=!reverse; if(currentWord) drawCurrentQuestion();};
DOM.fiftyBtn.onclick=useFifty;
DOM.modeBtn.onclick=()=>{
  inputMode=!inputMode;
  DOM.answers.style.display=inputMode?'none':'grid';
  DOM.inputDiv.style.display=inputMode?'block':'none';
  DOM.submitWrapper.style.display=inputMode?'block':'none';
  DOM.fiftyBtn.style.display=inputMode?'none':'inline-block';
  DOM.modeBtn.textContent=inputMode?'üéõÔ∏è':'‚úçÔ∏è';
  if(currentWord) drawCurrentQuestion();
};
DOM.submitBtn.addEventListener('mousedown', e=>e.preventDefault());
DOM.submitBtn.addEventListener('touchstart', e=>{e.preventDefault();submitFromButton();},{passive:false});
DOM.submitBtn.addEventListener('click', e=>{e.preventDefault();submitFromButton();});

// --- –∫–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —Å–ø–∏—Å–∫–æ–≤ –æ—Ñ–ª–∞–π–Ω ---
const saveAllBtn = document.getElementById('saveAllBtn');
saveAllBtn.onclick = async () => {
  try {
    const snapshot = await database.ref('lists').once('value');
    const data = snapshot.val() || {};
    localStorage.setItem('offlineLists', JSON.stringify(data));
    alert('–í—Å–µ —Å–ø–∏—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –æ—Ñ–ª–∞–π–Ω!');
  } catch (err) {
    console.error(err);
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–æ–≤');
  }
};

// --- —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤ ---
function loadAllLists(){
  // —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º offline
  const offline = localStorage.getItem('offlineLists');
  if (offline) {
    const data = JSON.parse(offline);
    populateListSelect(data);
  } else {
    database.ref('lists').once('value').then(snapshot=>{
      const data = snapshot.val()||{};
      populateListSelect(data);
    });
  }
}
loadAllLists();

function populateListSelect(data){
  DOM.listSelect.innerHTML = '<option disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫</option>';
  for(let key in data){
    const opt = document.createElement('option');
    opt.value = key;
    opt.textContent = key;
    DOM.listSelect.appendChild(opt);
  }
  DOM.word.textContent = "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤";
  DOM.word.classList.add("placeholder");
}

DOM.listSelect.onchange=()=>{
  const selected=DOM.listSelect.value;
  if(!selected) return;
  database.ref('lists/'+selected).once('value').then(snapshot=>{
    words=Object.values(snapshot.val());
    allWords=[...new Map(words.map(w=>[`${w.word};${w.trans}`,w])).values()];
    remainingWords=shuffle([...allWords]);
    index=correct_answers=wrong_answers=0; currentWord=null;
    DOM.word.classList.remove("placeholder");
    ['answers','progress','progressFill','switchBtn','fiftyBtn','modeBtn','progressBar'].forEach(el=>DOM[el].style.display=el==='answers'||el==='progressFill'||el==='switchBtn'||el==='fiftyBtn'||el==='modeBtn'||el==='progressBar'?'grid':'block');
    loadNextWord();
  });
};

DOM.addListToggle.onclick=()=>{DOM.addListForm.style.display=DOM.addListForm.style.display==='none'?'flex':'none';};
DOM.addListBtn.onclick=()=>{
  const name=DOM.newListName.value.trim(), text=DOM.newListText.value.trim();
  if(!name||!text) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–ø–∏—Å–∫–∞ –∏ —Å–ª–æ–≤–∞');
  const newWords=text.split('\n').map(l=>{const [w,t]=l.split(';').map(x=>x.trim()); return {word:w,trans:t};}).filter(x=>x.word&&x.trans);
  database.ref('lists/'+name).set(newWords).then(()=>{alert('–°–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω!'); DOM.newListName.value=''; DOM.newListText.value=''; DOM.addListForm.style.display='none'; loadAllLists();}).catch(err=>console.error(err));
};

// --- –∑–∞–ø—Ä–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è ---
document.addEventListener('gesturestart',e=>e.preventDefault());
let lastTouchEnd=0;
document.addEventListener('touchend',e=>{const now=Date.now(); if(now-lastTouchEnd<=300)e.preventDefault(); lastTouchEnd=now;},false);
document.addEventListener('touchstart',e=>{if(e.touches.length>1)e.preventDefault();},{passive:false});
</script>
</body>
</html>
