<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Word Quiz</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCgSFDj7fRw6HSvZyOz1g5IM749f2sY55M",
  authDomain: "wordquiz-659d7.firebaseapp.com",
  databaseURL: "https://wordquiz-659d7-default-rtdb.firebaseio.com",
  projectId: "wordquiz-659d7",
  storageBucket: "wordquiz-659d7.firebasestorage.app",
  messagingSenderId: "785560761880",
  appId: "1:785560761880:web:9455e5767af0e0b9b1f56d"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();
</script>

<link rel="manifest" href="manifest.json">

<style>
/* –¢–≤–æ–∏ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
html, body { width:100%; height:100%; margin:0; padding:0; overflow:hidden; touch-action:manipulation; }
body { display:flex; flex-direction:column; align-items:center; justify-content:flex-start; min-height:100vh; font-family:Arial, sans-serif; background-image:url('mountains.jpg'); background-size:cover; background-position:center; background-repeat:no-repeat; color:white; }
header { display:flex; justify-content:space-between; align-items:center; padding:10px 15px; box-sizing:border-box; box-shadow:0 2px 5px rgba(0,0,0,0.1); flex-wrap:nowrap; width:100%; }
header>div { display:flex; align-items:center; gap:8px; min-width:0; }
#title { font-weight:bold; font-size:1.2rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
#listSelect { padding:8px 12px; border-radius:12px; border:1px solid #ccc; font-size:0.95rem; min-width:100px; flex-shrink:1; text-overflow:ellipsis; overflow:hidden; white-space:nowrap; background:white; cursor:pointer; }
#listSelect::-ms-expand { display:none; }
#addListToggle { border-radius:12px; padding:8px 12px; font-weight:bold; background-color:#2196F3; color:white; cursor:pointer; flex-shrink:0; }
#switchBtn, #modeBtn, #fiftyBtn { padding:8px 12px; border-radius:12px; font-weight:bold; cursor:pointer; flex-shrink:0; }
#switchBtn { font-size:1.2rem; background-color:#4CAF50; color:white; border:none; }
#switchBtn:hover { background-color:#45a049; transform:scale(1.05); }
#modeBtn { background-color:#FF9800; color:white; border:none; }
#modeBtn:hover { background-color:#F57C00; }
#fiftyBtn { background-color:#2196F3; color:white; }
#fiftyBtn:hover { background-color:#1976D2; }
#word { font-size:calc(20px + 4vw); text-align:center; margin:20px 0; word-wrap:break-word; font-weight:bold; }
#word.placeholder { color:#ff4d4f; }
.answers { display:grid; grid-template-columns:1fr 1fr; gap:15px; width:95%; max-width:600px; }
.answerBtn { background-color:#f2f2f2; border:1px solid #ccc; border-radius:12px; font-size:1.2rem; padding:10px; min-height:50px; transition: background-color 0.2s, transform 0.1s, box-shadow 0.2s; cursor:pointer; font-weight:bold; word-wrap:break-word; white-space:normal; }
.answerBtn:hover { background-color:#e6e6e6; transform:scale(1.02); box-shadow:0 2px 5px rgba(0,0,0,0.2); }
.answerBtn.correct { background-color:#4CAF50; color:white; }
.answerBtn.wrong { background-color:#F44336; color:white; }
.answerBtn.disabled { background-color:#ddd; color:#666; }
#progressBar { width:95%; max-width:600px; height:20px; background:#eee; border-radius:10px; margin:15px 0; }
#progressFill { width:0%; height:100%; background:#4CAF50; border-radius:10px; transition:width 0.3s; }
#progress { font-size:1rem; text-align:center; }
#addListForm { display:none; flex-direction:column; gap:5px; margin:10px 0; width:95%; max-width:600px; }
#welcomeWrapper { flex-grow:1; display:flex; align-items:center; justify-content:center; }
#welcome { font-size:3rem; font-weight:bold; text-align:center; color:#ffffff; text-shadow:2px 2px 5px rgba(0,0,0,0.3); }
#answerInput { width:100%; font-size:1.3rem; padding:14px; border-radius:14px; border:2px solid #ccc; box-sizing:border-box; margin-top:10px; background:#fff; color:#000; transition:border-color 0.3s, box-shadow 0.3s; }
#answerInput.error { border:2px solid red !important; box-shadow:0 0 10px red; }
#answerInput.success { border:2px solid #00a550 !important; box-shadow:0 0 10px #00a550; }
#feedback { width:95%; max-width:600px; text-align:center; margin:20px 0 10px 0; min-height:2em; font-size:2rem; }
#feedback.ok { color:#00a550; }
#feedback.err { color:#ff0000; }
#submitAnswerBtn { width:100%; max-width:600px; font-size:1.4rem; padding:16px; border-radius:16px; font-weight:bold; background-color:#4CAF50; color:white; border:none; cursor:pointer; transition:background 0.2s, transform 0.1s; }
#submitAnswerBtn:hover { background-color:#45a049; transform:scale(1.02); }
#submitWrapper { position:sticky; bottom:calc(10px + env(safe-area-inset-bottom)); text-align:center; width:95%; max-width:600px; margin:0 auto; z-index:100; }
@media (max-width:480px){ #title{font-size:1rem;} #listSelect{font-size:0.8rem; min-width:80px;} #addListToggle,#switchBtn,#modeBtn,#fiftyBtn{padding:4px 8px; font-size:0.8rem;} #word{font-size:calc(18px+4vw);} #progress{font-size:0.9rem;} }
</style>
</head>
<body>

<header>
  <span id="title"></span>
  <div style="display:flex; gap:10px; align-items:center;">
    <select id="listSelect">
      <option disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫</option>
    </select>
    <button id="addListToggle">+</button>
  </div>
  <div>
    <button id="switchBtn">üåê</button>
    <button id="modeBtn">‚úçÔ∏è</button>
    <button id="fiftyBtn">50/50</button>
  </div>
</header>

<div id="addListForm">
  <input type="text" id="newListName" placeholder="–ò–º—è –Ω–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫–∞">
  <textarea id="newListText" placeholder="–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—é–¥–∞ —Å–ª–æ–≤–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å–ª–æ–≤–æ;–ø–µ—Ä–µ–≤–æ–¥" rows="5"></textarea>
  <button id="addListBtn">–î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
</div>

<div id="word" class="placeholder">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤</div>

<div class="answers" id="answers">
  <button class="answerBtn"></button>
  <button class="answerBtn"></button>
  <button class="answerBtn"></button>
  <button class="answerBtn"></button>
</div>

<div id="inputModeDiv" style="display:none; margin:20px 0; text-align:center; width:95%; max-width:600px;">
  <div id="feedback"></div>
  <input type="text" id="answerInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç" autocomplete="off" autocapitalize="none" spellcheck="false">
</div>

<div id="progressBar"><div id="progressFill"></div></div>
<div id="progress"></div>

<div id="submitWrapper" style="display:none; text-align:center; margin:20px 0; width:95%; max-width:600px;">
  <button id="submitAnswerBtn" type="button" tabindex="-1">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
</div>

<div id="welcomeWrapper">
  <div id="welcome">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</div>
</div>

<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js').then(() => console.log('SW –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'));
}

// ----------------------- JS –ò–≥—Ä–∞ (–æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–π –∫–æ–¥ main.js) -----------------------
let words=[], allWords=[], index=0, correct_answers=0, wrong_answers=0;
let reverse=false, currentWord=null, remainingWords=[], inputMode=false;

const switchBtn=document.getElementById('switchBtn');
const modeBtn=document.getElementById('modeBtn');
const fiftyBtn=document.getElementById('fiftyBtn');
const wordDiv=document.getElementById('word');
const answersDiv=document.getElementById('answers');
const inputModeDiv=document.getElementById('inputModeDiv');
const answerInput=document.getElementById('answerInput');
const feedback=document.getElementById('feedback');
const submitAnswerBtn=document.getElementById('submitAnswerBtn');
const submitWrapper=document.getElementById('submitWrapper');
const progressDiv=document.getElementById('progress');
const progressFill=document.getElementById('progressFill');

const listSelect=document.getElementById('listSelect');
const addListToggle=document.getElementById('addListToggle');
const addListForm=document.getElementById('addListForm');
const addListBtn=document.getElementById('addListBtn');
const newListName=document.getElementById('newListName');
const newListText=document.getElementById('newListText');

switchBtn.addEventListener('click',()=>{reverse=!reverse;if(currentWord) drawCurrentQuestion();});
fiftyBtn.addEventListener('click',useFifty);
modeBtn.addEventListener('click',()=>{inputMode=!inputMode; if(inputMode){answersDiv.style.display='none'; inputModeDiv.style.display='block'; submitWrapper.style.display='block'; fiftyBtn.style.display='none'; modeBtn.textContent='üéõÔ∏è'; focusInputSoon();} else {answersDiv.style.display='grid'; inputModeDiv.style.display='none'; submitWrapper.style.display='none'; fiftyBtn.style.display='inline-block'; modeBtn.textContent='‚úçÔ∏è';} if(currentWord) drawCurrentQuestion();});
submitAnswerBtn.addEventListener('click',e=>{e.preventDefault(); submitFromButton();});
submitAnswerBtn.addEventListener('touchstart',e=>{e.preventDefault(); submitFromButton();},{passive:false});
submitAnswerBtn.addEventListener('mousedown',e=>e.preventDefault());

function submitFromButton(){if(!currentWord) return; const correct=reverse?currentWord.word:currentWord.trans; checkTextAnswer(answerInput.value.trim(),correct);}
function focusInputSoon(){if(!inputMode) return; requestAnimationFrame(()=>{answerInput.focus({preventScroll:true}); const len=answerInput.value.length; try{answerInput.setSelectionRange(len,len);}catch(e){}});}

// ----------------------- –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–æ–≤ -----------------------
function loadAllLists(){
  if(navigator.onLine){
    database.ref('lists').once('value').then(snapshot=>{
      const data=snapshot.val()||{};
      populateListSelect(data);
      if('serviceWorker' in navigator && navigator.serviceWorker.controller){
        navigator.serviceWorker.controller.postMessage({type:'CACHE_LISTS', lists:data});
      }
    });
  } else {
    fetch('/all-lists.json').then(res=>res.json()).then(data=>populateListSelect(data)).catch(()=>{wordDiv.textContent="–°–ø–∏—Å–∫–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Äî –Ω–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –∏ –∫—ç—à–∞"; wordDiv.classList.add("placeholder");});
  }
}
function populateListSelect(data){
  listSelect.innerHTML='<option disabled selected>–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫</option>';
  for(let key in data){const option=document.createElement('option'); option.value=key; option.textContent=key; listSelect.appendChild(option);}
  wordDiv.textContent="–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤"; wordDiv.classList.add("placeholder");
}
loadAllLists();

listSelect.onchange=()=>{
  const selected=listSelect.value;
  if(!selected) return;
  if(navigator.onLine){
    database.ref('lists/'+selected).once('value').then(snapshot=>{words=Object.values(snapshot.val()); initWordList();});
  } else {
    fetch('/all-lists.json').then(res=>res.json()).then(data=>{words=Object.values(data[selected]||{}); initWordList();});
  }
};

function initWordList(){
  allWords=[...new Map(words.map(w=>[`${w.word};${w.trans}`,w])).values()];
  remainingWords=shuffleArray([...allWords]);
  index=0; correct_answers=0; wrong_answers=0; currentWord=null;
  answersDiv.style.display=inputMode?'none':'grid';
  inputModeDiv.style.display=inputMode?'block':'none';
  submitWrapper.style.display=inputMode?'block':'none';
  switchBtn.style.display='inline-block';
  fiftyBtn.style.display=inputMode?'none':'inline-block';
  modeBtn.style.display='inline-block';
  progressDiv.style.display='block';
  progressFill.style.display='block';
  loadNextWord();
}

// ----------------------- –ò–≥—Ä–∞ -----------------------
function loadNextWord(){if(remainingWords.length===0){wordDiv.textContent='–ì–æ—Ç–æ–≤–æ! –í—ã –ø—Ä–æ—à–ª–∏ –≤—Å–µ —Å–ª–æ–≤–∞ üéâ'; wordDiv.classList.remove('placeholder'); answersDiv.style.display='none'; inputModeDiv.style.display='none'; submitWrapper.style.display='none'; return;} currentWord=remainingWords.pop(); index++; document.getElementById('welcome').style.display='none'; drawCurrentQuestion(); focusInputSoon();}
function drawCurrentQuestion(){const question=reverse?currentWord.trans:currentWord.word; const correct=reverse?currentWord.word:currentWord.trans; wordDiv.textContent=question; wordDiv.classList.remove('placeholder'); progressDiv.textContent=`${index} –∏–∑ ${allWords.length} (${correct_answers}/${wrong_answers})`; progressFill.style.width=`${(index/allWords.length)*100}%`; if(!inputMode){const allOptions=allWords.map(x=>reverse?x.word:x.trans).filter(x=>x!==correct); let options=[correct,...shuffleArray(allOptions).slice(0,3)]; options=shuffleArray(options); const buttons=answersDiv.querySelectorAll('.answerBtn'); buttons.forEach((btn,i)=>{btn.textContent=options[i]; btn.disabled=false; btn.className='answerBtn'; btn.onclick=()=>checkAnswer(btn,correct);}); fiftyBtn.disabled=false;} else {feedback.textContent=''; feedback.className=''; answerInput.value=''; focusInputSoon(); answerInput.onkeydown=(e)=>{if(e.key==="Enter"){e.preventDefault(); submitFromButton();}};}}
function checkAnswer(btn, correct){if(!currentWord) return; if(btn.textContent===correct) correct_answers++; else wrong_answers++; const buttons=answersDiv.querySelectorAll('.answerBtn'); buttons.forEach(b=>{b.disabled=true; if(b.textContent===correct) b.classList.add('correct'); else if(b===btn) b.classList.add('wrong');}); setTimeout(()=>loadNextWord(), btn.textContent===correct?500:2000);}
function checkTextAnswer(userAnswer, correct){if(!userAnswer){answerInput.classList.add('error'); answerInput.style.transition='transform 0.2s'; answerInput.style.transform='translateY(-5px)'; setTimeout(()=>{answerInput.style.transform='translateY(5px)'; setTimeout(()=>answerInput.style.transform='translateY(0)',100);},100); setTimeout(()=>answerInput.classList.remove('error'),500); focusInputSoon(); return;} if(userAnswer.toLowerCase()===correct.toLowerCase()){correct_answers++; answerInput.classList.add('success'); answerInput.style.transition='transform 0.2s'; answerInput.style.transform='translateY(-5px)'; setTimeout(()=>{answerInput.style.transform='translateY(5px)'; setTimeout(()=>answerInput.style.transform='translateY(0)',100);},100); setTimeout(()=>answerInput.classList.remove('success'),500); setTimeout(()=>loadNextWord(),500);} else{wrong_answers++; feedback.textContent=correct; feedback.className='err'; setTimeout(()=>loadNextWord(),3000);} focusInputSoon();}
function useFifty(){const correct=reverse?currentWord.word:currentWord.trans; let wrongBtns=Array.from(answersDiv.querySelectorAll('.answerBtn')).filter(b=>b.textContent!==correct&&!b.disabled); shuffleArray(wrongBtns).slice(0,2).forEach(b=>{b.disabled=true; b.classList.add('disabled');}); fiftyBtn.disabled=true;}
function shuffleArray(array){for(let i=array.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1)); [array[i], array[j]]=[array[j], array[i]];} return array;}

// ----------------------- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ -----------------------
addListToggle.onclick=()=>{addListForm.style.display=addListForm.style.display==='none'?'flex':'none';};
addListBtn.onclick=()=>{
  const name=newListName.value.trim(); const text=newListText.value.trim();
  if(!name||!text) return alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Å–ø–∏—Å–∫–∞ –∏ —Å–ª–æ–≤–∞');
  const newWords=text.split('\n').map(line=>{const [word,trans]=line.split(';').map(x=>x.trim()); return {word,trans};}).filter(x=>x.word&&x.trans);
  database.ref('lists/'+name).set(newWords).then(()=>{alert('–°–ø–∏—Å–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω!'); newListName.value=''; newListText.value=''; addListForm.style.display='none'; loadAllLists();}).catch(err=>console.error(err));
};

// ----------------------- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è -----------------------
document.addEventListener('gesturestart', e=>e.preventDefault());
let lastTouchEnd=0;
document.addEventListener('touchend', e=>{const now=new Date().getTime(); if(now-lastTouchEnd<=300) e.preventDefault(); lastTouchEnd=now;}, false);
document.addEventListener('touchstart', e=>{if(e.touches.length>1) e.preventDefault();},{passive:false});
</script>
</body>
</html>
